{% extends "base.html" %}
{% block title %}All Projects{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="dashboard-header">
  <div class="header-content">
    <div class="page-title-section">
      <h1 class="gradient-text">
        <i class="fas fa-folder-open"></i> 
        All Projects
      </h1>
      <p class="page-subtitle">Manage and organize your project portfolio</p>
    </div>
  </div>
</div>

<!-- Main Projects Section -->
<div class="projects-section">

  {% if all_projects %}
    <!-- Owned Projects Section -->
    {% if owned_projects %}
    <div class="task-section">
      <div class="section-header">
        <h3 class="section-title-modern">
          <i class="fas fa-crown"></i>
          Owned Projects
          <span class="task-count-badge">{{ owned_projects|length }}</span>
        </h3>
        <a href="{{ url_for('create_project') }}" class="btn-compact btn-primary">
          <i class="fas fa-plus"></i>
          <span>New Project</span>
        </a>
      </div>
      <div id="ownedProjectsList" class="tasks-grid">
        {% for project in owned_projects %}
        <div class="task-card" data-project-id="{{ project.id }}">
          <div class="task-card-inner">
            <!-- Project Card Main Content -->
            <div class="task-card-main">
              <!-- Project Card Header -->
              <div class="task-card-header">
                <div class="project-title-section">
                  <div class="project-color-indicator" style="background-color: {{ project.color }}"></div>
                  <h3 class="task-title">{{ project.name }}</h3>
                </div>
                {% if project.workspace %}
                <div class="workspace-badge-modern">
                  <i class="fas fa-layer-group"></i>
                  {{ project.workspace.name }}
                </div>
                {% endif %}
              </div>
              
              <!-- Project Card Content -->
              <div class="task-card-content">
                {% if project.description %}
                <div class="task-description">
                  <p>{{ project.description }}</p>
                </div>
                {% endif %}
                
                <div class="task-meta">
                  <span class="task-due">
                    <i class="fas fa-tasks"></i>
                    {{ project.tasks|length }} tasks
                  </span>
                  <span class="task-created">
                    <i class="fas fa-users"></i>
                    {{ project.members|length }} members
                  </span>
                  <span class="task-created">
                    <i class="fas fa-calendar"></i>
                    {{ project.created_at.strftime('%m/%d') }}
                  </span>
                </div>
              </div>
            </div>
            
            <!-- Project Card Actions (Right Side) -->
            <div class="task-card-actions">
              <a href="{{ url_for('project_detail', project_id=project.id) }}" class="btn-compact btn-success">
                <i class="fas fa-eye"></i>
                <span>View</span>
              </a>
              <button class="btn-compact btn-danger" onclick="confirmDeleteProject({{ project.id }}, '{{ project.name }}')">
                <i class="fas fa-trash"></i>
                <span>Delete</span>
              </button>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}

    <!-- Member Projects Section -->
    {% if member_projects %}
    <div class="task-section">
      <div class="section-header">
        <h3 class="section-title-modern">
          <i class="fas fa-users"></i>
          Member Projects
          <span class="task-count-badge">{{ member_projects|length }}</span>
        </h3>
      </div>
      <div id="memberProjectsList" class="tasks-grid">
        {% for project in member_projects %}
        <div class="task-card" data-project-id="{{ project.id }}">
          <div class="task-card-inner">
            <!-- Project Card Main Content -->
            <div class="task-card-main">
              <!-- Project Card Header -->
              <div class="task-card-header">
                <div class="project-title-section">
                  <div class="project-color-indicator" style="background-color: {{ project.color }}"></div>
                  <h3 class="task-title">{{ project.name }}</h3>
                </div>
                <div class="task-priority-badge priority-low">
                  <i class="fas fa-user"></i>
                  Member
                </div>
              </div>
              
              <!-- Project Card Content -->
              <div class="task-card-content">
                {% if project.description %}
                <div class="task-description">
                  <p>{{ project.description }}</p>
                </div>
                {% endif %}
                
                <div class="task-meta">
                  <span class="task-due">
                    <i class="fas fa-tasks"></i>
                    {{ project.tasks|length }} tasks
                  </span>
                  <span class="task-created">
                    <i class="fas fa-users"></i>
                    {{ project.members|length }} members
                  </span>
                  <span class="task-created">
                    <i class="fas fa-crown"></i>
                    {{ project.owner.full_name or project.owner.email }}
                  </span>
                </div>
                
                {% if project.workspace %}
                <div class="workspace-info">
                  <i class="fas fa-layer-group"></i>
                  <span>{{ project.workspace.name }}</span>
                </div>
                {% endif %}
              </div>
            </div>
            
            <!-- Project Card Actions (Right Side) -->
            <div class="task-card-actions">
              <a href="{{ url_for('project_detail', project_id=project.id) }}" class="btn-compact btn-success">
                <i class="fas fa-eye"></i>
                <span>View</span>
              </a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  {% else %}
    <div class="empty-state-modern">
      <div class="empty-content">
        <div class="empty-icon">
          <i class="fas fa-folder-open"></i>
        </div>
        <h3>No Projects Yet</h3>
        <p>Create your first project to get started with organizing your tasks.</p>
        <a href="{{ url_for('create_project') }}" class="btn-compact btn-primary">
          <i class="fas fa-plus"></i>
          <span>Create Your First Project</span>
        </a>
      </div>
    </div>
  {% endif %}
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-exclamation-triangle"></i> Delete Project</h3>
            <button type="button" class="btn-icon modal-close" onclick="closeDeleteModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to delete the project "<span id="projectNameToDelete"></span>"?</p>
            <p class="warning-text">This action cannot be undone. All tasks and data associated with this project will be permanently deleted.</p>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn-outline" onclick="closeDeleteModal()">Cancel</button>
            <form id="deleteForm" method="POST" style="display: inline;">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn-danger">
                    <i class="fas fa-trash"></i> Delete Project
                </button>
            </form>
        </div>
    </div>
</div>

<script>
let projectToDelete = null;

function confirmDeleteProject(projectId, projectName) {
    projectToDelete = projectId;
    document.getElementById('projectNameToDelete').textContent = projectName;
    document.getElementById('deleteForm').action = `/project/${projectId}/delete`;
    document.getElementById('deleteModal').style.display = 'flex';
}

function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
    projectToDelete = null;
}

// Close modal when clicking outside
document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteModal();
    }
});

// Dropdown functionality
document.addEventListener('DOMContentLoaded', function() {
    const dropdownToggles = document.querySelectorAll('.dropdown-toggle');
    
    dropdownToggles.forEach(toggle => {
        toggle.addEventListener('click', function(e) {
            e.stopPropagation();
            const dropdown = this.closest('.dropdown');
            const menu = dropdown.querySelector('.dropdown-menu');
            
            // Close other dropdowns
            document.querySelectorAll('.dropdown-menu').forEach(m => {
                if (m !== menu) m.style.display = 'none';
            });
            
            // Toggle current dropdown
            menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
        });
    });
    
    // Close dropdowns when clicking outside
    document.addEventListener('click', function() {
        document.querySelectorAll('.dropdown-menu').forEach(menu => {
            menu.style.display = 'none';
        });
    });
});
</script>
{% endblock %}
